<!DOCTYPE html>
<html>
<head>
    <title>Enhanced zkML Parameter Display Test</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #e0e0e0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .test-header h1 {
            color: #06b6d4;
            font-size: 28px;
            margin-bottom: 10px;
        }
        .test-description {
            color: #9ca3af;
            font-size: 14px;
        }
        .test-button {
            background: linear-gradient(135deg, #6b7cff 0%, #8b9aff 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            transition: all 0.3s;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(107, 124, 255, 0.3);
        }
        .test-button:disabled {
            background: #374151;
            cursor: not-allowed;
            transform: none;
        }
        #messages {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 20px;
            min-height: 400px;
        }
        .status-message {
            text-align: center;
            padding: 20px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß† Enhanced zkML Parameter Display Test</h1>
            <div class="test-description">
                Testing the new interactive 14-parameter LLM decision proof visualization
            </div>
        </div>
        
        <button id="testButton" class="test-button" onclick="runEnhancedTest()">
            Start Enhanced Workflow Test
        </button>
        
        <div id="messages"></div>
        
        <div id="status" style="display: none;" class="status-message"></div>
    </div>
    
    <!-- Load required scripts -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="/static/js/gateway-zkml-polling.js"></script>
    
    <script>
        async function runEnhancedTest() {
            console.log('Starting enhanced parameter display test...');
            
            const button = document.getElementById('testButton');
            button.disabled = true;
            button.textContent = 'Running Test...';
            
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '‚è≥ Initializing test...';
            
            try {
                // Clear previous messages
                document.getElementById('messages').innerHTML = '';
                
                // Execute the workflow which will show the enhanced parameter display
                const result = await window.GatewayZKMLHandler.executeWorkflow('2');
                
                if (result.success) {
                    statusDiv.innerHTML = `
                        <div style="color: #10b981; font-size: 18px; font-weight: 600;">
                            ‚úÖ Test Complete!
                        </div>
                        <div style="margin-top: 10px; color: #e0e0e0;">
                            Click on "üß† 14 LLM Decision Parameters Validated" in Step 1 above to expand the detailed view.
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; color: #9ca3af;">
                            The proof was generated using the real JOLT-Atlas Rust binary in ~500ms
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div style="color: #ef4444;">
                            ‚ùå Test failed: ${result.error}
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; color: #9ca3af;">
                            Make sure all backend services are running:
                            <ul style="text-align: left;">
                                <li>zkML Backend on port 8002</li>
                                <li>Groth16 Backend on port 3004</li>
                            </ul>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Test failed:', error);
                statusDiv.innerHTML = `
                    <div style="color: #ef4444;">
                        ‚ùå Test error: ${error.message}
                    </div>
                `;
            } finally {
                button.disabled = false;
                button.textContent = 'Run Test Again';
            }
        }
        
        // Check backend status on load
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('http://localhost:8002/health');
                const data = await response.json();
                if (data.services.binaryExists) {
                    console.log('‚úÖ JOLT-Atlas binary found and ready');
                } else {
                    console.warn('‚ö†Ô∏è JOLT-Atlas binary not found');
                }
            } catch (e) {
                console.error('Cannot reach zkML backend:', e);
            }
        });
    </script>
</body>
</html>
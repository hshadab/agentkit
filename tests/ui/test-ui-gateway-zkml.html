<!DOCTYPE html>
<html>
<head>
    <title>Test Gateway zkML with 14 Parameters</title>
    <style>
        body {
            background: #0a0a0a;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 40px;
        }
        .test-section {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
        }
        button {
            background: #6B7CFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        button:hover {
            background: #8B9AFF;
        }
        .result {
            background: #000;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            margin-top: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .link { color: #8B9AFF; text-decoration: none; }
        .link:hover { text-decoration: underline; }
        h1 {
            background: linear-gradient(135deg, #6B7CFF 0%, #4A5A8A 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body>
    <h1>üß™ Gateway zkML Test - Full 14-Parameter Model</h1>
    
    <div class="test-section">
        <h2>Automated Test - Full Workflow</h2>
        <p>This will test the complete Gateway zkML workflow with the 14-parameter model:</p>
        <ol>
            <li>Generate zkML proof with 14 parameters</li>
            <li>Perform real on-chain verification on Ethereum Sepolia</li>
            <li>Display transaction links</li>
        </ol>
        <button onclick="runFullTest()">Run Complete Test</button>
        <div id="result" class="result">Click button to start test...</div>
    </div>
    
    <div class="test-section">
        <h2>Manual UI Test</h2>
        <p>To test in the main UI:</p>
        <ol>
            <li>Open <a href="http://localhost:8000" target="_blank" class="link">http://localhost:8000</a></li>
            <li>Type: "gateway zkml transfer $0.01 to 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb"</li>
            <li>Check that Step 2 shows Etherscan link</li>
            <li>Check that Step 3 shows Gateway transfer links</li>
        </ol>
    </div>
    
    <script>
        function log(msg, type = '') {
            const result = document.getElementById('result');
            const timestamp = new Date().toLocaleTimeString();
            const className = type ? ` class="${type}"` : '';
            result.innerHTML += `<span${className}>[${timestamp}] ${msg}</span>\n`;
            result.scrollTop = result.scrollHeight;
        }
        
        async function runFullTest() {
            const result = document.getElementById('result');
            result.innerHTML = '';
            log('Starting Gateway zkML test with 14-parameter model...\n');
            
            try {
                // Step 1: Generate 14-parameter proof
                log('STEP 1: Generating 14-parameter zkML proof...');
                const proofResp = await fetch('http://localhost:8002/zkml/prove', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        agentId: 'ui-test-14param',
                        agentType: 'financial',
                        amount: 0.01,
                        operation: 'gateway_transfer',
                        riskScore: 0.25
                    })
                });
                
                const proof = await proofResp.json();
                log(`Session ID: ${proof.sessionId}`);
                
                // Wait for proof
                log('Waiting for proof generation (10 seconds)...');
                await new Promise(r => setTimeout(r, 10000));
                
                // Check proof status
                const statusResp = await fetch(`http://localhost:8002/zkml/status/${proof.sessionId}`);
                const status = await statusResp.json();
                
                const paramCount = status.proof?.proofData?.publicInputs?.length || 0;
                log(`Proof status: ${status.status}`);
                log(`Model: ${status.proof?.model}`);
                log(`Parameters: ${paramCount}`);
                
                if (paramCount !== 14) {
                    log(`‚ùå ERROR: Expected 14 parameters, got ${paramCount}`, 'error');
                    return;
                }
                log('‚úÖ Confirmed: Using 14-parameter model', 'success');
                
                // Step 2: On-chain verification
                log('\nSTEP 2: Performing on-chain verification...');
                const verifyResp = await fetch('http://localhost:3003/zkml/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sessionId: proof.sessionId,
                        proof: status.proof?.proofData || {},
                        network: 'sepolia',
                        useRealChain: true,
                        inputs: status.proof?.proofData?.publicInputs || []
                    })
                });
                
                const verification = await verifyResp.json();
                
                if (verification.txHash) {
                    log('‚úÖ On-chain verification successful!', 'success');
                    log(`Transaction Hash: ${verification.txHash}`);
                    const etherscanUrl = `https://sepolia.etherscan.io/tx/${verification.txHash}`;
                    log(`<a href="${etherscanUrl}" target="_blank" class="link">View on Etherscan ‚Üí</a>`);
                    log(`Block Number: ${verification.blockNumber}`);
                    log(`Gas Used: ${verification.gasUsed}`);
                } else {
                    log('‚ùå No transaction hash returned', 'error');
                }
                
                // Summary
                log('\n========================================');
                log('Test Summary:', 'success');
                log(`  zkML Proof: ‚úÖ (${paramCount} parameters)`);
                log(`  Model: ${status.proof?.model}`);
                log(`  On-chain Verification: ${verification.txHash ? '‚úÖ' : '‚ùå'}`);
                log(`  Transaction Link: ${verification.txHash ? 'Available' : 'Not available'}`);
                
                if (verification.txHash) {
                    log('\n‚úÖ ALL TESTS PASSED - 14-parameter model working end-to-end!', 'success');
                }
                
            } catch (error) {
                log(`\n‚ùå Error: ${error.message}`, 'error');
                log('\nMake sure backend services are running:', 'error');
                log('  1. node api/zkml-backend.js (port 8002)', 'error');
                log('  2. node api/zkml-verifier-backend.js (port 3003)', 'error');
            }
        }
    </script>
</body>
</html>